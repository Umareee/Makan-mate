<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delivery Details - Makan Mate</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'makan-orange': '#FF5722',
            'makan-orange-hover': '#E64A19',
            'custom-topbar': '#474747',
            'custom-navbar': '#F9F9F7',
            'custom-logo-bg': '#F9F9F71F',
            'custom-text': '#2C2F24',
          },
          fontFamily: {
            'playfair': ['Playfair Display', 'serif'],
            'dm-sans': ['DM Sans', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-white font-dm-sans text-custom-text">
   <!-- ===== header (unchanged) ===== -->
  <header class="bg-gray-800 text-white">
    <div class="bg-custom-topbar py-2 px-2">
      <div class="container mx-auto px-2 sm:px-4 text-xs sm:text-sm">
        <!-- Mobile Layout -->
        <div class="flex sm:hidden justify-between items-start py-1">
          <div class="flex items-center space-x-1">
            <i class="fas fa-phone"></i>
            <span>62642233 Ext 10-18</span>
          </div>
          <div class="flex flex-col items-end space-y-1">
            <div class="flex items-center space-x-1">
              <i class="fas fa-envelope"></i>
              <span>order@makanmate.com</span>
            </div>
            <div class="flex space-x-2">
            <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-twitter text-xs"></i>
            </a>
            <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-facebook text-xs"></i>
            </a>
            <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-instagram text-xs"></i>
            </a>
              <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
                <i class="fab fa-github text-xs"></i>
              </a>
            </div>
          </div>
        </div>
        <!-- Desktop Layout -->
        <div class="hidden sm:flex justify-between items-center">
          <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
              <i class="fas fa-phone"></i>
              <span>62642233 Ext 10-18</span>
            </div>
            <div class="flex items-center space-x-2">
              <i class="fas fa-envelope"></i>
              <span>order@makanmate.com</span>
            </div>
          </div>
          <div class="flex space-x-3">
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-facebook"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-github"></i>
            </a>
          </div>
        </div>
        </div>
      </div>
    </div>
  </header>

 <!-- Main navigation -->
    <nav class="bg-custom-navbar text-custom-text py-4 px-2 shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-2 sm:px-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center cursor-pointer" onclick="window.location.href='index.html'">
          <img src="/images/mate-logo.png" alt="Makan Mate Logo" class="w-10 h-10 rounded-full">
        </div>
        <div>
          <h1 class="text-xl sm:text-2xl font-bold text-makan-orange font-playfair cursor-pointer" onclick="window.location.href='index.html'">Makan Mate</h1>
        </div>
            </div>
            <!-- Navigation Links -->
            <div class="hidden lg:flex items-center space-x-4 xl:space-x-8">
                <a href="index.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Home</a>
                <a href="about.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">About</a>
                                 <div class="group">
        <a href="menu.html" id="menu-trigger" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Catering</a>

        <!-- Full-width mega panel -->
        <div class="absolute inset-x-0 top-full bg-white hidden group-hover:block border-t border-gray-200 shadow-sm z-50">
            <div class="px-4 lg:px-128">
                <div class="max-w-4xl mx-auto py-4">
                    <!-- Menu Grid -->
                    <div class="flex justify-center">
                        <div id="menu-grid" class="grid grid-cols-3 gap-4 max-w-4xl w-full">
                            <!-- 1. Seminar -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('seminar')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Seminar</span>
                            </a>
                            <!-- 2. Wedding -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('wedding')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Wedding</span>
                            </a>
                            <!-- 3. Festive Special -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('festive')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Festive Special</span>
                            </a>
                            <!-- 4. Vegan/Healthy -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('vegan')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Vegan/Healthy</span>
                            </a>
                            <!-- 5. Mini-Buffet -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('mini-buffet')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Mini-Buffet</span>
                            </a>
                            <!-- 6. Buffet -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('buffet')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Buffet</span>
                            </a>
                            <!-- 7. Bento Set -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('bento')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Bento Set</span>
                            </a>
                            <!-- 8. Plated Meal -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('plated')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Plated Meal</span>
                            </a>
                            <!-- 9. Live Station -->
                            <a href="javascript:void(0)" onclick="goToMenuCategory('live-station')"
                               class="menu-item block text-center p-3 hover:bg-gray-50 rounded">
                                <span class="text-sm text-custom-text hover:text-makan-orange">Live Station</span>
                            </a>
                        </div>
                    </div>
                    <!-- CTA Button -->
                    <div class="text-center py-6">
                        <a href="menu.html" class="inline-block bg-makan-orange text-white px-6 py-3 rounded-full font-medium hover:bg-makan-orange-hover transition">See All Menu</a>
                    </div>
                </div>
            </div>
        </div>


 

      </div>
                <a href="mealkits.html" class="bg-makan-orange text-white px-4 py-2 rounded-full hover:bg-makan-orange-hover transition-colors ">Delivery</a>
                <a href="weekly-meal-plan.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Plans</a>
                <a href="#" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Mart</a>
                <a href="past-events.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Gallery</a>
                <a href="contact.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Contact</a>
            </div>

            <!-- Mobile menu button -->
            <div class="lg:hidden">
                <button class="text-custom-text hover:text-makan-orange">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 py-10">
    <h2 class="text-3xl font-playfair font-bold mb-6">Delivery Details</h2>
    
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <!-- LEFT SIDEBAR - Order Summary -->
      <aside class="lg:col-span-4 p-6 bg-gray-50 border border-gray-200 rounded-lg h-fit">
        <div class="text-lg font-bold text-makan-orange mb-4 border-b-2 border-dotted border-orange-300 pb-2">
          YOUR ORDER SUMMARY
        </div>
        
        <div id="order-summary">
          <!-- Order items will be dynamically populated here -->
        </div>
        
        <div class="border-t border-gray-300 mt-4 pt-4">
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <div class="text-md">Subtotal:</div>
              <div id="order-subtotal" class="text-md">$0.00</div>
            </div>
            <!-- Applied Discounts/Gift Cards -->
            <div id="applied-discounts" class="hidden">
              <div class="flex justify-between items-center text-green-600">
                <div class="text-md">
                  <span id="discount-type">Discount</span> (<span id="discount-code-display"></span>):
                </div>
                <div id="discount-amount" class="text-md">-$0.00</div>
              </div>
            </div>
            <!-- High-rise Surcharge -->
            <div id="highrise-surcharge" class="hidden">
              <div class="flex justify-between items-center text-makan-orange">
                <div class="text-md">High-rise Surcharge:</div>
                <div id="surcharge-amount" class="text-md">+$5.00</div>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <div class="text-md">GST (9%):</div>
              <div id="order-gst" class="text-md">$0.00</div>
            </div>
            <div class="border-t border-gray-200 pt-2 mt-2">
              <div class="flex justify-between items-center">
                <div class="text-lg font-bold">TOTAL:</div>
                <div id="order-total" class="text-2xl font-bold text-makan-orange">$0.00</div>
              </div>
            </div>
          </div>
        </div>
        
      </aside>

      <!-- RIGHT CONTENT - Delivery Form -->
      <section class="lg:col-span-8">
        <form class="space-y-8" id="delivery-form">

          <!-- Login for Faster Checkout -->
          <div class="p-6 bg-white border border-gray-200 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <i class="fas fa-sign-in-alt mr-2 text-makan-orange"></i>
              Log in for faster checkout (no password needed)
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Email Address</label>
                <input type="email" id="login-email" placeholder="Enter your email" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent">
                <button type="button" id="email-login-btn" class="mt-2 bg-makan-orange hover:bg-makan-orange-hover text-white px-4 py-2 rounded text-sm transition-colors">
                  Sign up / Login with Email
                </button>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">WhatsApp Number</label>
                <input type="tel" id="login-whatsapp" placeholder="Enter your WhatsApp number" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent">
                <button type="button" id="whatsapp-login-btn" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors">
                  <i class="fab fa-whatsapp mr-1"></i> Sign up / Login with WhatsApp
                </button>
              </div>
            </div>
          </div>

         

          <!-- Contact Information -->
          <div class="p-6 bg-white border border-gray-200 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <i class="fas fa-user mr-2 text-makan-orange"></i>
              Contact Information
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <!-- Name -->
              <div class="sm:col-span-2">
                <label class="block text-sm font-medium mb-1">Name (surname, last name)*</label>
                <input type="text" id="full-name" placeholder="Enter your full name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent" required>
              </div>
              
              <!-- Mobile Number -->
              <div>
                <label class="block text-sm font-medium mb-1">Mobile Number*</label>
                <input type="tel" id="mobile" placeholder="Enter your mobile number" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent" required>
              </div>
              
              <!-- Email -->
              <div>
                <label class="block text-sm font-medium mb-1">Email*</label>
                <input type="email" id="email" placeholder="Enter your email address" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent" required>
              </div>
            </div>
          </div>

          <!-- Delivery Address -->
          <div class="p-6 bg-white border border-gray-200 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <i class="fas fa-truck mr-2 text-makan-orange"></i>
              Delivery Address*
            </h3>
            <div class="space-y-4">
              <!-- Address Field -->
              <div>
                <label class="block text-sm font-medium mb-1">Delivery Address*</label>
                <textarea id="delivery-address" rows="2" placeholder="Enter your full delivery address" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent" required></textarea>
              </div>
              
              <!-- Property Type -->
              <div>
                <label class="block text-sm font-medium mb-2">Property Type*</label>
                <div class="flex space-x-6">
                  <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" name="property-type" value="landed" class="w-4 h-4 text-makan-orange focus:ring-2 focus:ring-makan-orange" required>
                    <span>Landed</span>
                  </label>
                  <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" name="property-type" value="high-rise" class="w-4 h-4 text-makan-orange focus:ring-2 focus:ring-makan-orange" required>
                    <span>High-rise (surcharge applies automatically)</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          

          <!-- Special Remarks -->
          <div class="p-6 bg-white border border-gray-200 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <i class="fas fa-clipboard-list mr-2 text-makan-orange"></i>
              Special Remarks (if any):
            </h3>
            <textarea id="remarks" maxlength="200" rows="3" placeholder="Any special instructions or remarks" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent"></textarea>
            <div class="text-xs text-gray-500 mt-1 text-right">
              <span id="char-count">0</span>/200
            </div>
          </div>

           <!-- Discount Code / Gift Card -->
          <div class="p-6 bg-white border border-gray-200 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <i class="fas fa-tag mr-2 text-makan-orange"></i>
              Discount Code / Gift Card
            </h3>
            <div class="max-w-md">
              <label class="block text-sm font-medium mb-1">Enter Code</label>
              <div class="flex">
                <input type="text" id="promo-code" placeholder="Enter discount code or gift card" class="flex-1 border border-gray-300 rounded-l-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-makan-orange focus:border-transparent">
                <button type="button" id="apply-code-btn" class="bg-makan-orange hover:bg-makan-orange-hover text-white px-4 py-2 rounded-r-lg transition-colors">
                  Apply
                </button>
              </div>
              <div id="code-message" class="text-sm mt-1 hidden"></div>
              <p class="text-xs text-gray-500 mt-2">Enter discount codes (e.g., SAVE10) or gift card codes (e.g., GC123456)</p>
            </div>
          </div>

          <!-- Submit -->
          <div class="pt-6">
            <button type="submit" class="bg-makan-orange hover:bg-makan-orange-hover text-white px-8 py-3 rounded-lg shadow-md transition-colors font-bold text-lg">
              Proceed to Payment <i class="fa fa-angle-double-right ml-2"></i>
            </button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-custom-topbar text-white py-8 mt-12">
    <div class="container mx-auto grid grid-cols-1 sm:grid-cols-3 gap-6 px-4">
      <div>
        <h3 class="font-bold text-lg mb-2">Makan Mate</h3>
        <p class="text-sm text-gray-300">Your trusted partner for catering services in Singapore.</p>
      </div>
      <div>
        <h3 class="font-bold text-lg mb-2">Quick Links</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="index.html" class="hover:text-makan-orange">Home</a></li>
          <li><a href="about.html" class="hover:text-makan-orange">About</a></li>
          <li><a href="menu.html" class="hover:text-makan-orange">Catering</a></li>
          <li><a href="contact.html" class="hover:text-makan-orange">Contact</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-lg mb-2">Contact Us</h3>
        <p class="text-sm"><i class="fas fa-phone mr-1"></i> 62642233 Ext 10-18</p>
        <p class="text-sm"><i class="fas fa-envelope mr-1"></i> order@makanmate.com</p>
        <div class="flex space-x-3 mt-3">
          <a href="#" class="w-8 h-8 flex items-center justify-center rounded-full bg-custom-logo-bg hover:text-makan-orange"><i class="fab fa-facebook"></i></a>
          <a href="#" class="w-8 h-8 flex items-center justify-center rounded-full bg-custom-logo-bg hover:text-makan-orange"><i class="fab fa-twitter"></i></a>
          <a href="#" class="w-8 h-8 flex items-center justify-center rounded-full bg-custom-logo-bg hover:text-makan-orange"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
    <div class="text-center text-gray-400 text-sm mt-6">© 2025 Makan Mate. All rights reserved.</div>
  </footer>

<script>
/* Global variables for discount tracking */
let appliedDiscount = null;
let highriseSurcharge = 5.00; // $5 surcharge for high-rise
let isHighrise = false;

/* =========  DOM READY  ========= */
document.addEventListener('DOMContentLoaded', () => {
  loadOrderSummary();
  setupFormFunctionality();
});

/* =========  ORDER SUMMARY  ========= */
function loadOrderSummary() {
  const $summary = document.getElementById('order-summary');
  const $subtotal = document.getElementById('order-subtotal');
  const $gst = document.getElementById('order-gst');
  const $total = document.getElementById('order-total');

  // Get combined multi-order cart
  const multiOrderCart = getMultiOrderCart();
  
  if (!multiOrderCart || multiOrderCart.length === 0) {
    $summary.innerHTML = `
      <div class="text-gray-500 text-center py-8">
        <i class="fas fa-shopping-cart text-3xl mb-2"></i><br>
        No items in your order.<br>
        <span class="text-sm">Please go back to select your menu items.</span>
      </div>`;
    $subtotal.textContent = '$0.00';
    $gst.textContent = '$0.00';
    $total.textContent = '$0.00';
    return;
  }

  // Display multiple orders summary
  let summaryHTML = '';
  let grandTotal = 0;
  
  multiOrderCart.forEach((order, index) => {
    const menuName = order.menuName || `Order ${index + 1}`;
    const packs = order.packs || 0;
    const orderTotal = order.total || 0;
    grandTotal += orderTotal;
    
    summaryHTML += `
      <div class="border border-gray-200 rounded-lg overflow-hidden bg-white mb-3">
        <div class="bg-gray-50 border-b border-gray-200 p-3">
          <div class="flex items-center space-x-2">
            <div class="flex-1">
              <div class="text-xs font-semibold text-gray-800">${menuName}</div>
              <div class="text-xs text-makan-orange font-medium">${packs} ${packs === 1 ? 'Pack' : 'Packs'} - $${orderTotal.toFixed(2)}</div>
            </div>
          </div>
        </div>
        
        <div class="p-2">
          <div class="space-y-1">`;

    // Add selected items from this order (show first few items)
    if (order.items && order.items.length > 0) {
      const itemsToShow = order.items.slice(0, 3); // Show max 3 items
      itemsToShow.forEach(item => {
        const itemName = item.name || item.title || 'Item';
        
        summaryHTML += `
          <div class="flex items-center space-x-2 p-1 bg-gray-50 rounded text-xs">
            <div class="flex-1 truncate">${itemName}</div>
          </div>`;
      });
      
      if (order.items.length > 3) {
        summaryHTML += `
          <div class="text-xs text-gray-500 text-center py-1">
            +${order.items.length - 3} more items
          </div>`;
      }
    } else {
      summaryHTML += `
        <div class="text-center py-2 text-gray-500">
          <i class="fas fa-info-circle mb-1 text-xs"></i>
          <p class="text-xs">Items based on selection</p>
        </div>`;
    }

    summaryHTML += `
          </div>
        </div>
      </div>`;
  });

  $summary.innerHTML = summaryHTML;
  
  // Apply discount if available
  let discountAmount = 0;
  if (appliedDiscount) {
    if (appliedDiscount.discountType === 'percentage') {
      discountAmount = grandTotal * (appliedDiscount.amount / 100);
    } else {
      discountAmount = appliedDiscount.amount;
    }
    // Don't let discount exceed the subtotal
    discountAmount = Math.min(discountAmount, grandTotal);
  }
  
  // Add high-rise surcharge if applicable
  let surchargeAmount = isHighrise ? highriseSurcharge : 0;
  
  const discountedSubtotal = grandTotal - discountAmount;
  const subtotalWithSurcharge = discountedSubtotal + surchargeAmount;
  const gstAmount = subtotalWithSurcharge * 0.09;
  const totalWithGst = subtotalWithSurcharge + gstAmount;
  
  // Update display
  $subtotal.textContent = `$${grandTotal.toFixed(2)}`;
  $gst.textContent = `$${gstAmount.toFixed(2)}`;
  $total.textContent = `$${totalWithGst.toFixed(2)}`;
  
  // Show/hide discount section
  const discountSection = document.getElementById('applied-discounts');
  if (appliedDiscount && discountAmount > 0) {
    document.getElementById('discount-type').textContent = appliedDiscount.type;
    document.getElementById('discount-code-display').textContent = appliedDiscount.code;
    document.getElementById('discount-amount').textContent = `-$${discountAmount.toFixed(2)}`;
    discountSection.classList.remove('hidden');
  } else {
    discountSection.classList.add('hidden');
  }
}

/* Update order summary when discount is applied */
function updateOrderSummaryWithDiscount() {
  loadOrderSummary();
}

/* =========  CART MANAGEMENT FUNCTIONS  ========= */
function getMultiOrderCart() {
  try {
    const stored = localStorage.getItem('multiOrderCart');
    return stored ? JSON.parse(stored) : [];
  } catch (e) {
    console.warn('Error parsing multi-order cart', e);
    return [];
  }
}

/* =========  FORM LOGIC  ========= */
function setupFormFunctionality() {
  /* same-address copy */
  const $same = document.getElementById('same-address');
  const $delFields = document.getElementById('delivery-address-fields');
  $same?.addEventListener('change', () => {
    const dis = $same.checked;
    document.getElementById('delivery-zipcode').value = document.getElementById('billing-zipcode').value;
    document.getElementById('delivery-unit').value   = document.getElementById('billing-unit').value;
    $delFields.querySelectorAll('input').forEach(inp => {
      inp.disabled = dis;
      inp.classList.toggle('bg-gray-100', dis);
    });
  });

  /* zip stub lookup */
  document.getElementById('billing-zipcode')?.addEventListener('blur', function () {
    if (this.value.length === 6) {
      setTimeout(() => {
        document.getElementById('billing-block').value  = '123';
        document.getElementById('billing-street').value = 'Sample Street';
      }, 500);
    }
  });

  /* char counter */
  const $rem = document.getElementById('remarks');
  const $cnt = document.getElementById('char-count');
  if ($rem && $cnt) {
    $rem.addEventListener('input', () => ($cnt.textContent = $rem.value.length));
  }

  /* form submit */
  document.getElementById('delivery-form')?.addEventListener('submit', e => {
    e.preventDefault();
    const required = [...e.target.querySelectorAll('[required]')];
    let ok = true;
    window.location.href = 'thank-you.html';
    required.forEach(f => {
      const missing = !f.value.trim();
      f.classList.toggle('border-red-500', missing);
      if (missing) ok = false;
    });
    if (!ok) return alert('Please fill in all required fields.');

    const data = {
      ecoOptions: {
        noCutlery: document.getElementById('no-cutlery')?.checked,
        noHeatpros: document.getElementById('no-heatpros')?.checked
      },
      personalInfo: {
        salutation: document.getElementById('salutation')?.value,
        surname:    document.getElementById('surname')?.value,
        givenName:  document.getElementById('givenName')?.value,
        corporateOrder: document.getElementById('corporate-order')?.checked
      },
      contactInfo: {
        email:      document.getElementById('email')?.value,
        mobile:     document.getElementById('mobile')?.value,
        alternative:document.getElementById('alternative')?.value
      },
      billingAddress: {
        zipcode: document.getElementById('billing-zipcode')?.value,
        unit:    document.getElementById('billing-unit')?.value,
        block:   document.getElementById('billing-block')?.value,
        street:  document.getElementById('billing-street')?.value,
        landedHouse: document.getElementById('landed-house')?.checked
      },
      deliveryAddress: {
        sameAsBilling: document.getElementById('same-address')?.checked,
        zipcode: document.getElementById('delivery-zipcode')?.value,
        unit:    document.getElementById('delivery-unit')?.value
      },
      otherInfo: {
        firstOrder: document.querySelector('input[name="firstOrder"]:checked')?.value,
        remarks:    document.getElementById('remarks')?.value
      }
    };
    localStorage.setItem('deliveryFormData', JSON.stringify(data));
    alert('Form submitted successfully!');
    // window.location.href = 'payment.html';
  });

  /* Login functionality */
  document.getElementById('email-login-btn')?.addEventListener('click', () => {
    const email = document.getElementById('login-email')?.value;
    if (!email) {
      alert('Please enter your email address');
      return;
    }
    // Simulate login process
    alert('Login link sent to ' + email + '. Please check your email.');
    // Here you would typically send a login link to the email
  });

  document.getElementById('whatsapp-login-btn')?.addEventListener('click', () => {
    const whatsapp = document.getElementById('login-whatsapp')?.value;
    if (!whatsapp) {
      alert('Please enter your WhatsApp number');
      return;
    }
    // Simulate WhatsApp login
    alert('Login code sent to ' + whatsapp + ' via WhatsApp.');
    // Here you would typically send a login code via WhatsApp
  });

  /* Combined promo code functionality */
  document.getElementById('apply-code-btn')?.addEventListener('click', () => {
    const code = document.getElementById('promo-code')?.value.toUpperCase().trim();
    const messageEl = document.getElementById('code-message');
    
    if (!code) {
      messageEl.textContent = 'Please enter a code';
      messageEl.className = 'text-sm mt-1 text-red-600';
      messageEl.classList.remove('hidden');
      return;
    }

    let discountInfo = null;

    // Check if it's a gift card (starts with GC and is 8 characters)
    if (code.startsWith('GC') && code.length === 8) {
      // Gift card validation - fixed amount
      discountInfo = {
        code: code,
        type: 'Gift Card',
        discountType: 'fixed',
        amount: 25.00 // $25 gift card for testing
      };
      messageEl.textContent = `✓ Gift card "${code}" applied successfully!`;
      messageEl.className = 'text-sm mt-1 text-green-600';
      messageEl.classList.remove('hidden');
    } else {
      // Discount code validation
      const discountCodes = {
        'SAVE10': { type: 'Discount', discountType: 'percentage', amount: 10 },
        'WELCOME20': { type: 'Discount', discountType: 'percentage', amount: 20 },
        'FIRST15': { type: 'Discount', discountType: 'percentage', amount: 15 },
        'NEWUSER': { type: 'Discount', discountType: 'fixed', amount: 5.00 },
        'HOLIDAY25': { type: 'Discount', discountType: 'percentage', amount: 25 },
        'TEST50': { type: 'Discount', discountType: 'fixed', amount: 50.00 } // Dummy code for testing
      };
      
      if (discountCodes[code]) {
        discountInfo = {
          code: code,
          type: discountCodes[code].type,
          discountType: discountCodes[code].discountType,
          amount: discountCodes[code].amount
        };
        messageEl.textContent = `✓ Discount code "${code}" applied successfully!`;
        messageEl.className = 'text-sm mt-1 text-green-600';
        messageEl.classList.remove('hidden');
      } else {
        messageEl.textContent = 'Invalid code. Please check and try again.';
        messageEl.className = 'text-sm mt-1 text-red-600';
        messageEl.classList.remove('hidden');
        return;
      }
    }

    // Store the applied discount and update the sidebar
    if (discountInfo) {
      appliedDiscount = discountInfo;
      updateOrderSummaryWithDiscount();
    }
  });
}
 let menuData = null;
async function loadMenuData() {
    if (menuData) return menuData;          // already cached
    try {
        const res = await fetch('/menu-items.json');
        menuData = await res.json();
        return menuData;
    } catch (err) {
        console.error('Could not load /menu-items.json', err);
    }
}
        /* Handle clicks on the menu cards */
document.addEventListener('click', async (e) => {
    const card = e.target.closest('[data-item-id]');
    if (!card) return;

    const id = card.dataset.itemId;
    const data = await loadMenuData();
    const item = data.items.find(i => i.id === id);

    if (!item) {
        Swal.fire({ icon:'info', title:'Coming soon', text:'This item is not configured yet.' });
        return;
    }

    /* Same localStorage structure used in menu.html */
    localStorage.setItem('selectedMenuItem', JSON.stringify({
        name: item.name,
        id: item.id,
        price: item.price,
        description: item.description,
        customizable: item.customizable,
        data_source: item.data_source
    }));

    /* Go straight to quantity-selection, just like menu.html */
    window.location.href = 'quantity-selection.html';
});

 //Filtering script
  const filterBtns = document.querySelectorAll('.filter-btn');
  const menuItems = document.querySelectorAll('.menu-item');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter');

      menuItems.forEach(item => {
        if (filter === 'all' || item.getAttribute('data-category') === filter) {
          item.style.display = 'flex'; // show
        } else {
          item.style.display = 'none'; // hide
        }
      });

      // Active button style
      filterBtns.forEach(b => b.classList.remove('bg-makan-orange', 'text-white'));
      btn.classList.add('bg-makan-orange', 'text-white');
    });
  });

   // Function to navigate to menu page with selected category
  function goToMenuCategory(categoryId) {
    console.log('Storing category for navigation:', categoryId);
    localStorage.setItem('selectedMenuCategory', categoryId);
    window.location.href = 'menu.html';
  }

  // Hover menu with delay
const menuTrigger = document.getElementById('menu-trigger');
const menuPanel = document.querySelector('.group .absolute');

if (menuTrigger && menuPanel) {
    let menuTimeout;
    
    menuTrigger.addEventListener('mouseenter', () => {
        clearTimeout(menuTimeout);
        menuPanel.classList.remove('hidden');
    });
    
    menuTrigger.addEventListener('mouseleave', () => {
        menuTimeout = setTimeout(() => {
            menuPanel.classList.add('hidden');
        }, 1000); // 1 second delay
    });
    
    menuPanel.addEventListener('mouseenter', () => {
        clearTimeout(menuTimeout);
        menuPanel.classList.remove('hidden');
    });
    
    menuPanel.addEventListener('mouseleave', () => {
        menuTimeout = setTimeout(() => {
            menuPanel.classList.add('hidden');
        }, 200); 
    });
}
</script>
</body>
</html>
