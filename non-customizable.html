<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menu (Non-Customizable) — Makan Mate</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'makan-orange': '#FF5722',
            'makan-orange-hover': '#E64A19',
            'custom-topbar': '#474747',
            'custom-navbar': '#F9F9F7',
            'custom-logo-bg': '#F9F9F71F',
            'custom-text': '#2C2F24',
            'panel-blue': '#eef7fb',
            'panel-blue-border': '#e1eef4'
          },
          fontFamily: {
            'playfair': ['Playfair Display','serif'],
            'dm-sans': ['DM Sans','sans-serif']
          }
        }
      }
    }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;600&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    body { font-family: "DM Sans", sans-serif; }
    .dotted-hr { border-bottom: 2px dotted #f4a18b; padding-bottom: 8px; display: inline-block; }
    .cat-topline { height: 6px; border-bottom: 1px solid #e1edf3; margin-top: 6px; }
  </style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-white font-dm-sans text-custom-text">

  <!-- Header -->
  <header class="bg-gray-800 text-white">
    <div class="bg-custom-topbar py-2 px-2">
      <div class="container mx-auto px-2 sm:px-4 text-xs sm:text-sm">
        <!-- Mobile Layout -->
        <div class="flex sm:hidden justify-between items-start py-1">
          <div class="flex items-center space-x-1">
            <i class="fas fa-phone"></i>
            <span>62642233 Ext 10-18</span>
          </div>
          <div class="flex flex-col items-end space-y-1">
            <div class="flex items-center space-x-1">
              <i class="fas fa-envelope"></i>
              <span>order@makanmate.com</span>
            </div>
            <div class="flex space-x-2">
              <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
                <i class="fab fa-twitter text-xs"></i>
              </a>
              <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
                <i class="fab fa-facebook text-xs"></i>
              </a>
              <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
                <i class="fab fa-instagram text-xs"></i>
              </a>
              <a href="#" class="w-6 h-6 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
                <i class="fab fa-github text-xs"></i>
              </a>
            </div>
          </div>
        </div>
        <!-- Desktop Layout -->
        <div class="hidden sm:flex justify-between items-center">
          <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
              <i class="fas fa-phone"></i>
              <span>62642233 Ext 10-18</span>
            </div>
            <div class="flex items-center space-x-2">
              <i class="fas fa-envelope"></i>
              <span>order@makanmate.com</span>
            </div>
          </div>
          <div class="flex space-x-3">
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-facebook"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="w-8 h-8 bg-custom-logo-bg rounded-full flex items-center justify-center hover:text-makan-orange transition-colors">
              <i class="fab fa-github"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main navigation -->
  <nav class="bg-custom-navbar text-custom-text py-4 px-2 shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-2 sm:px-4 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center cursor-pointer" onclick="window.location.href='index.html'">
          <img src="/images/mate-logo.png" alt="Makan Mate Logo" class="w-10 h-10 rounded-full">
        </div>
        <div>
          <h1 class="text-xl sm:text-2xl font-bold text-makan-orange font-playfair cursor-pointer" onclick="window.location.href='index.html'">Makan Mate</h1>
        </div>
      </div>
      <div class="hidden lg:flex items-center space-x-4 xl:space-x-8">
        <a href="index.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Home</a>
        <a href="about.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">About</a>
        <a href="menu.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Menu</a>
        <a href="mealkits.html" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Meal Kits</a>
        <a href="#" class="text-custom-text hover:text-makan-orange transition-colors font-medium">Pages</a>
        <a href="contact.html" class=" text-custom-text hover:text-makan-orange transition-colors font-medium">Contact</a>
        <a href="order.html" class="bg-makan-orange border-2 border-makan-orange text-white px-6 py-2 rounded-full hover:bg-custom-navbar hover:text-black transition-colors font-medium">Order Now</a>
      </div>
      <div class="lg:hidden">
        <button class="text-custom-text hover:text-makan-orange">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="container mx-auto px-4 py-8 max-w-6xl">
    <h2 class="text-2xl font-playfair font-bold mb-6">Menu — Fixed Sets</h2>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- LEFT SIDEBAR -->
      <aside class="lg:col-span-3 lg:order-1 p-4 bg-gray-50 border border-gray-200 rounded-lg">
        <div class="text-xs text-makan-orange font-semibold mb-3">
          <span class="dotted-hr">ORDER DETAILS</span>
        </div>

        <!-- Delivery Date and Time -->
        <div class="mb-6">
          <h4 class="font-semibold text-custom-text mb-2">Delivery Date & Time</h4>
          <div class="space-y-2">
            <input type="date" id="delivery-date" class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-makan-orange">
            <input type="time" id="delivery-time" class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-makan-orange">
          </div>
        </div>

        <!-- Previous Selections -->
        <div class="mb-6">
          <h4 class="font-semibold text-gray-800 mb-2">Previous Selections</h4>
          <div class="space-y-3" id="previous-selections-container">
          </div>
        </div>


        <!-- Number of Packs -->
        <div class="mb-6">
          <h4 class="font-semibold text-custom-text mb-2">Number of Packs</h4>
          <div class="flex gap-2 items-center">
            <button class="w-8 h-8 bg-makan-orange rounded text-white text-sm font-bold hover:bg-makan-orange-hover transition-colors" onclick="changePacks(-1)">▼</button>
            <input class="flex-1 text-center border border-gray-300 h-8 rounded text-sm focus:outline-none focus:ring-2 focus:ring-makan-orange" type="number" value="10" min="10" id="packs-input">
            <button class="w-8 h-8 bg-makan-orange rounded text-white text-sm font-bold hover:bg-makan-orange-hover transition-colors" onclick="changePacks(1)">▲</button>
          </div>
          <p class="text-xs text-gray-500 mt-1">Minimum: 10 packs</p>
        </div>

        <!-- Cart Summary -->
        <div class="">
          <div id="cart-container">
            <!-- Previous selections will be loaded here -->
            <div id="previous-selections-container"></div>
            <!-- Current cart items will be added here -->
            <div id="current-cart-items">
              <div class="text-gray-500 text-sm text-center py-4">
                <i class="fas fa-shopping-cart text-xl mb-2"></i><br>
                No additional items selected yet.
              </div>
            </div>
          </div>
          <div class="border-t border-gray-300 mt-4 pt-4" id="cart-total" style="display: none;">
            <div class="text-sm font-semibold">TOTAL: <span id="total-amount" class="text-lg">$0.00</span></div>
          </div>
        </div>
      </aside>

      <!-- RIGHT CONTENT -->
      <section class="lg:col-span-9 lg:order-2">
        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        <div class="mt-6">
          <button id="next-bottom" class="bg-makan-orange text-white px-6 py-3 rounded-lg font-bold hover:bg-makan-orange-hover transition-colors"><i class="fas fa-shopping-cart mr-2"></i>ADD TO CART</button>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-12 mt-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        <div class="mx-0 sm:mx-4">
          <h4 class="text-lg font-bold text-white mb-6">Company</h4>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">About Us</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Our Team</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Careers</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Contact</a></li>
          </ul>
        </div>
        <div class="mx-0 sm:mx-4">
          <h4 class="text-lg font-bold text-white mb-6">Services</h4>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Catering</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Delivery</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Events</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Corporate</a></li>
          </ul>
        </div>
        <div class="mx-0 sm:mx-4">
          <h4 class="text-lg font-bold text-white mb-6">Quick Links</h4>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Menu</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Order Now</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">Locations</a></li>
            <li><a href="#" class="text-gray-300 hover:text-makan-orange transition-colors">FAQs</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-bold text-white mb-6">Follow Us On Instagram</h4>
          <div class="grid grid-cols-2 gap-3">
            <div class="aspect-square rounded-lg overflow-hidden">
              <img src="/images/pexels-steve-3789885 1.png" alt="Instagram Food Post" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
            </div>
            <div class="aspect-square rounded-lg overflow-hidden">
              <img src="/images/eiliv-aceron-d5PbKQJ0Lu8-unsplash 1.png" alt="Instagram Food Post" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
            </div>
            <div class="aspect-square rounded-lg overflow-hidden">
              <img src="/images/pexels-ella-olsson-1640772 1.png" alt="Instagram Food Post" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
            </div>
            <div class="aspect-square rounded-lg overflow-hidden">
              <img src="/images/pexels-ash-376464 1.png" alt="Instagram Food Post" class="w-full h-full object-cover hover:scale-110 transition-transform duration-300">
            </div>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-12 pt-8 text-center">
        <p class="text-gray-400">Copyright © 2025 Makan Mate. All Rights Reserved</p>
      </div>
    </div>
  </footer>

  <!-- Mobile menu (hidden by default) -->
  <div class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="mobile-menu">
    <div class="bg-white w-64 h-full p-6">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-xl font-bold text-makan-orange">Menu</h2>
        <button class="text-gray-600" id="close-menu">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <nav class="space-y-4">
        <a href="index.html" class="block text-custom-text hover:text-makan-orange transition-colors py-2 border-b">Home</a>
        <a href="about.html" class="block text-custom-text hover:text-makan-orange transition-colors py-2 border-b">About</a>
        <a href="menu.html" class="block text-custom-text hover:text-makan-orange transition-colors py-2 border-b">Menu</a>
        <a href="#" class="block text-custom-text hover:text-makan-orange transition-colors py-2 border-b">Pages</a>
        <a href="contact.html" class="block text-custom-text hover:text-makan-orange transition-colors py-2 border-b">Contact</a>
        <a href="order.html" class="block bg-makan-orange text-white px-4 py-2 rounded-full text-center mt-6">Order Now</a>
      </nav>
    </div>
  </div>

  <!-- JS -->
 <script>
    // Non-customizable menu data
    let menuItemData = {};
    let cart = [];
    let packs = 10;

    // Load menu data from JSON file
    async function loadMenuData() {
      try {
        const response = await fetch('non-customizable-data.json');
        const data = await response.json();
        menuItemData = data;
        console.log('Menu data loaded:', menuItemData);
        
        // Force a specific menu item for testing (comment out in production)
        // Uncomment below line to test with a specific menu
        // localStorage.setItem('selectedMenuItem', JSON.stringify({categoryKey: 'bento-special', name: 'Bento Special', image: '/images/pexels-ruslan-khmelevsky-7845121 1.png', price: 20.99}));
        
        renderCards();
        updateCartDisplay();
      } catch (error) {
        console.error('Error loading menu data:', error);
        // Fallback: show error message
        document.getElementById('cards-container').innerHTML = '<p class="text-red-500">Error loading menu data. Please refresh the page.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Date/time defaults
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('delivery-date').min = today;
      const now = new Date();
      now.setHours(now.getHours() + 1);
      document.getElementById('delivery-time').value = now.toTimeString().slice(0,5);

      // Load previous selections into Your Selection section with 10x multiplier
const previousContainer = document.getElementById('previous-selections-container');
if (previousContainer) {
  let cardsHtml = '';
  
  // Add the quantity selection item (from quantity-selection.html) as the main previous selection
  try {
    const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
    if (selectedWithQuantity) {
      // Apply minimum 10 packs multiplier for non-customizable
      const originalQuantity = selectedWithQuantity.quantityTitle || 
                             `${selectedWithQuantity.quantity} ${selectedWithQuantity.quantity === '1' ? 'Pack' : 'Packs'}`;
      const basePrice = Number(selectedWithQuantity.totalPrice || selectedWithQuantity.price || 0);
      const multipliedPrice = (basePrice * 10).toFixed(2);
      
      // Update localStorage with the multiplied selection
      const multipliedSelection = {
        ...selectedWithQuantity,
        nonCustomizableQuantity: 10,
        nonCustomizablePrice: multipliedPrice,
        originalQuantity: originalQuantity,
        originalPrice: selectedWithQuantity.totalPrice || selectedWithQuantity.price
      };
      localStorage.setItem('selectedItemWithQuantity', JSON.stringify(multipliedSelection));
      
      cardsHtml += `
      <div class="bg-white p-3 rounded border border-gray-200 mb-2">
        <div class="flex items-center gap-3">
          <img src="${selectedWithQuantity.image}" alt="${selectedWithQuantity.name}" class="w-12 h-12 rounded object-cover">
          <div class="flex-1">
            <div class="text-sm font-semibold text-gray-800">${selectedWithQuantity.name}</div>
            <div class="text-xs text-gray-500">${originalQuantity} × 10 packs = ${parseInt(selectedWithQuantity.quantity || 1) * 10} total packs</div>
          </div>
        </div>
      </div>`;
      
      // Hide the "No additional items" message since we have previous selections
      const currentCartItems = document.getElementById('current-cart-items');
      if (currentCartItems && cardsHtml) {
        currentCartItems.innerHTML = '';
      }
    }
  } catch {}
  
  // Set the previous selections HTML
  previousContainer.innerHTML = cardsHtml;
}
      
      // Load menu data and render cards
      loadMenuData();
    });


    function renderCards() {
      const container = document.getElementById('cards-container');
      container.innerHTML = '';
      
      if (Object.keys(menuItemData).length === 0) {
        container.innerHTML = '<p class="text-gray-500">Loading menu items...</p>';
        return;
      }
      
      // Check if there's a selected item from previous page
      const selectedItem = getSelectedItemFromStorage();
      
      if (selectedItem) {
        // Show only the selected item
        renderSelectedItemCard(selectedItem, container);
      } else {
        // Fallback: show all items if no selection found
        Object.keys(menuItemData).forEach(category => {
          const categoryData = menuItemData[category];
          const card = document.createElement('div');
          card.className = 'bg-blue-50 border border-blue-200 rounded-lg p-4';
          card.innerHTML = `
            <div class="font-semibold text-gray-800 uppercase text-base mb-1">${categoryData.name}</div>
            <div class="cat-topline mb-3"></div>
            <div class="w-full h-36 rounded overflow-hidden mb-3">
              <img src="${categoryData.image}" alt="${categoryData.name}" class="w-full h-full object-cover">
            </div>
            <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mb-3">
              ${categoryData.items.map(item => `<li>${item}</li>`).join('')}
            </ul>
            <div class="flex items-center gap-2">
              <button class="w-8 h-8 bg-orange-500 rounded text-white text-sm font-bold hover:bg-orange-600 transition-colors" onclick="changeCardQuantity('${category}', -1)">▼</button>
              <input id="${category}-card-qty" class="card-qty-input w-28 text-center border border-gray-300 h-8 rounded text-sm focus:outline-none focus:ring-2 focus:ring-orange-500" type="number" value="${packs}" min="${packs}" oninput="onCardQtyInput('${category}')">
              <button class="w-8 h-8 bg-orange-500 rounded text-white text-sm font-bold hover:bg-orange-600 transition-colors" onclick="changeCardQuantity('${category}', 1)">▲</button>
              <button id="${category}-add-btn" class="ml-auto bg-orange-500 text-white px-3 py-2 rounded text-sm font-bold hover:bg-orange-600 transition-colors" onclick="addCardToCart('${category}')">Add</button>
            </div>
          `;
          container.appendChild(card);
        });
      }
    }

    function renderSelectedItemCard(selectedItem, container) {
      const category = selectedItem.categoryKey;
      const categoryData = menuItemData[category];
      
      if (!categoryData) {
        console.error('Category not found in menu data:', category);
        container.innerHTML = '<p class="text-red-500">Selected item not found in menu data.</p>';
        return;
      }
      
      const card = document.createElement('div');
      card.className = 'bg-blue-50 border border-blue-200 rounded-lg p-4 md:col-span-1';
      card.innerHTML = `
        <div class="font-semibold text-gray-800 uppercase text-base mb-1">${categoryData.name}</div>
        <div class="cat-topline mb-3"></div>
        <div class="w-full h-36 rounded overflow-hidden mb-3">
          <img src="${categoryData.image}" alt="${categoryData.name}" class="w-full h-full object-cover">
        </div>
        <div class="text-sm text-orange-500 font-semibold mb-2">What's included:</div>
        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mb-3">
          ${categoryData.items.map(item => `<li>${item}</li>`).join('')}
        </ul>
      `;
      container.appendChild(card);
      
      // Update the page title to reflect the selected item
      const pageTitle = document.querySelector('main h2');
      if (pageTitle) {
        pageTitle.textContent = `${categoryData.name} — Non-Customizable`;
      }
    }

    function toTitle(slug) { return slug.replace(/-/g,' ').replace(/\b\w/g, c => c.toUpperCase()); }

    // Map menu item IDs to non-customizable category keys
    function getMenuIdToCategoryMapping() {
      return {
        'premium-bento': 'premium-bento',
        'martinez-cocktail': 'vegetarian-catering',
        'bento-special-menu': 'bento-special',
        'mint-lemonade': 'mini-catering',
        'korean-street-bento': 'korean-street',
        'indian-menu': 'indian-cuisine',
        'korean-menu': 'korean-street',
        'delight-menu': 'international-delight'
      };
    }

    function getSelectedItemFromStorage() {
      console.log('🔍 Getting selected item from storage...');
      
      // Debug: Check what's in localStorage
      console.log('localStorage selectedItemWithQuantity:', localStorage.getItem('selectedItemWithQuantity'));
      console.log('localStorage selectedMenuItem:', localStorage.getItem('selectedMenuItem'));
      console.log('URL search params:', window.location.search);
      
      // Try to get from different possible localStorage keys
      try {
        // First try the detailed selection with quantity
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        console.log('selectedWithQuantity parsed:', selectedWithQuantity);
        
        if (selectedWithQuantity && selectedWithQuantity.categoryKey) {
          console.log('✅ Found selected item with quantity:', selectedWithQuantity);
          return {
            categoryKey: selectedWithQuantity.categoryKey,
            name: selectedWithQuantity.name,
            image: selectedWithQuantity.image,
            price: selectedWithQuantity.price
          };
        }
        
        // Then try basic selected menu item
        const selected = JSON.parse(localStorage.getItem('selectedMenuItem') || 'null');
        console.log('selectedMenuItem parsed:', selected);
        
        if (selected) {
          let categoryKey = selected.categoryKey;
          
          // If no categoryKey, try to map from the item ID
          if (!categoryKey && selected.id) {
            const idToCategory = getMenuIdToCategoryMapping();
            categoryKey = idToCategory[selected.id];
            console.log(`🔄 Mapped ID '${selected.id}' to category '${categoryKey}'`);
          }
          
          // Verify the category exists in our data
          if (categoryKey && menuItemData[categoryKey]) {
            console.log('✅ Found valid category:', categoryKey);
            return {
              categoryKey: categoryKey,
              name: selected.name,
              image: selected.image,
              price: selected.price
            };
          }
        }
        
        // If neither exists, try to infer from URL parameters or other sources
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCategory = urlParams.get('category');
        console.log('URL category param:', selectedCategory);
        
        if (selectedCategory && menuItemData[selectedCategory]) {
          console.log('✅ Found category from URL:', selectedCategory);
          return {
            categoryKey: selectedCategory,
            name: toTitle(selectedCategory),
            image: getCategoryHeroImage(selectedCategory),
            price: computeCategoryPrice(selectedCategory)
          };
        }
        
      } catch (error) {
        console.error('❌ Error getting selected item:', error);
      }
      
      console.log('❌ No selected item found - will show all items');
      return null;
    }


    // function changeCardQuantity(category, delta) {
    //   const input = document.getElementById(`${category}-card-qty`);
    //   const newVal = Math.max(packs, Number(input.value) + delta);
    //   input.value = newVal;
    //   upsertCard(category, newVal);
    // }

    // function onCardQtyInput(category) {
    //   const input = document.getElementById(`${category}-card-qty`);
    //   let val = Number(input.value);
    //   if (Number.isNaN(val) || val < packs) val = packs;
    //   input.value = val;
    //   upsertCard(category, val);
    // }


    function addCardToCart(category) {
      const input = document.getElementById(`${category}-card-qty`);
      const qty = Math.max(packs, Number(input.value) || packs);
      upsertCard(category, qty);
      // Reflect added state on the button
      markAdded(category);
    }

    function getAddBtn(category) {
      return document.getElementById(`${category}-add-btn`);
    }

    function markAdded(category) {
      const btn = getAddBtn(category);
      if (!btn) return;
      btn.textContent = 'Added';
      btn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
      btn.classList.add('bg-green-600', 'hover:bg-green-700');
    }

    function markAdd(category) {
      const btn = getAddBtn(category);
      if (!btn) return;
      btn.textContent = 'Add';
      btn.classList.remove('bg-green-600', 'hover:bg-green-700');
      btn.classList.add('bg-orange-500', 'hover:bg-orange-600');
    }

    function upsertCard(category, quantity) {
      const id = `card:${category}`;
      const priceEach = computeCategoryPrice(category);
      const name = toTitle(category);
      const image = getCategoryHeroImage(category);
      const existingIndex = cart.findIndex(ci => ci.id === id);
      const cartItem = { id, category, name, image, price: priceEach, quantity };
      if (existingIndex > -1) cart[existingIndex] = cartItem; else cart.push(cartItem);
      updateCartDisplay();
    }

    function computeCategoryPrice(category) {
      const categoryData = menuItemData[category];
      return categoryData ? categoryData.price : 0;
    }

    function getCategoryHeroImage(category) {
      const categoryData = menuItemData[category];
      return categoryData ? categoryData.image : '/images/menu/imgi_161_Bento-Set-A-chicken-300x300.jpg';
    }

    function changePacks(change) {
      const packsInput = document.getElementById('packs-input');
      const newPacks = Math.max(10, Number(packsInput.value) + change);
      packs = newPacks;
      packsInput.value = packs;
      
      // Update previous selection with new pack count
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        if (selectedWithQuantity) {
          const originalPrice = Number(selectedWithQuantity.originalPrice || selectedWithQuantity.totalPrice || selectedWithQuantity.price || 0);
          const newMultipliedPrice = (originalPrice * newPacks).toFixed(2);
          
          selectedWithQuantity.nonCustomizableQuantity = newPacks;
          selectedWithQuantity.nonCustomizablePrice = newMultipliedPrice;
          
          localStorage.setItem('selectedItemWithQuantity', JSON.stringify(selectedWithQuantity));
          
          // Update the display
          updatePreviousSelectionDisplay();
        }
      } catch {}
      
      // Update all qty inputs
      document.querySelectorAll('.card-qty-input').forEach(ip => {
        ip.min = packs;
        if (Number(ip.value) < packs) ip.value = packs;
      });
      // Bump cart items
      cart = cart.map(ci => ({ ...ci, quantity: Math.max(ci.quantity, packs) }));
      updateCartDisplay();
    }

    function updatePreviousSelectionDisplay() {
      const previousContainer = document.getElementById('previous-selections-container');
      if (!previousContainer) return;
      
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        if (selectedWithQuantity) {
          const originalQuantity = selectedWithQuantity.originalQuantity;
          const currentPacks = selectedWithQuantity.nonCustomizableQuantity || 10;
          const currentPrice = selectedWithQuantity.nonCustomizablePrice;
          
          previousContainer.innerHTML = `
          <div class="bg-white p-3 rounded border border-gray-200 mb-2">
            <div class="flex items-center gap-3">
              <img src="${selectedWithQuantity.image}" alt="${selectedWithQuantity.name}" class="w-12 h-12 rounded object-cover">
              <div class="flex-1">
                <div class="text-sm font-semibold text-gray-800">${selectedWithQuantity.name}</div>
              </div>
            </div>
          </div>`;
        }
      } catch {}
    }

    function updateCartDisplay() {
      const currentCartContainer = document.getElementById('current-cart-items');
      const cartTotal = document.getElementById('cart-total');
      const totalAmount = document.getElementById('total-amount');
      
      // Calculate total from previous selections (with 10x multiplier)
      let total = 0;
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        if (selectedWithQuantity) {
          // Use the non-customizable multiplied price if available, otherwise apply 10x multiplier
          const previousTotal = selectedWithQuantity.nonCustomizablePrice || 
                               (Number(selectedWithQuantity.totalPrice || selectedWithQuantity.price || 0) * 10);
          total += Number(previousTotal);
        }
      } catch {}
      
      if (cart.length === 0) {
        if (total > 0) {
          // If we have previous selections but no current cart items
          currentCartContainer.innerHTML = '';
          cartTotal.style.display = 'block';
        } else {
          // If no previous selections and no current cart items
          currentCartContainer.innerHTML = `
            <div class="text-gray-500 text-sm text-center py-4">
              <i class="fas fa-shopping-cart text-xl mb-2"></i><br>
              No additional items selected yet.
            </div>`;
          cartTotal.style.display = 'none';
        }
      } else {
        cartTotal.style.display = 'block';
        currentCartContainer.innerHTML = '';
        cart.forEach((item, index) => {
          const subtotal = item.price * item.quantity;
          total += subtotal;
          const row = document.createElement('div');
          row.className = 'bg-white p-3 rounded border border-gray-200 mb-2';
          row.innerHTML = `
            <div class="flex items-center space-x-2">
              <img src="${item.image}" alt="${item.name}" class="w-12 h-12 object-cover rounded">
              <div class="flex-1">
                <div class="text-sm font-semibold text-gray-800">${item.name}</div>
                <div class="text-xs text-gray-500">Qty: ${item.quantity}</div>
              </div>
              <div class="text-right">
                <button class="text-red-500 text-xs hover:text-red-700" onclick="removeFromCart(${index})">Remove</button>
              </div>
            </div>`;
          currentCartContainer.appendChild(row);
        });
      }
      totalAmount.textContent = `${total.toFixed(2)}`;
    }

    function removeFromCart(index) {
      const removed = cart.splice(index, 1)[0];
      updateCartDisplay();
      if (removed && removed.category) {
        // If an item is removed from cart, revert its button to Add
        markAdd(removed.category);
      }
    }

    document.getElementById('next-bottom').addEventListener('click', () => {
      // Check if we have previous selections or current cart items
      let hasItems = false;
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        hasItems = selectedWithQuantity !== null || cart.length > 0;
      } catch {
        hasItems = cart.length > 0;
      }
      
      if (!hasItems) { 
        Swal.fire({ icon: 'warning', title: 'No items', text: 'Please add at least one item.' });
        return; 
      }
      
      const deliveryDate = document.getElementById('delivery-date').value;
      const deliveryTime = document.getElementById('delivery-time').value;
      if (!deliveryDate || !deliveryTime) { 
        Swal.fire({ icon: 'error', title: 'Missing info', text: 'Please select delivery date and time.' });
        return; 
      }
      
      // Prepare cart data including previous selection
      const finalCart = [];
      
      // Add your main selection (from previous steps)
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        if (selectedWithQuantity) {
          const totalPrice = Number(selectedWithQuantity.nonCustomizablePrice || (selectedWithQuantity.originalPrice || selectedWithQuantity.price || 0) * 10);
          const quantity = selectedWithQuantity.nonCustomizableQuantity || 10;
          const pricePerUnit = totalPrice / quantity;
          
          finalCart.push({
            name: selectedWithQuantity.name,
            image: selectedWithQuantity.image,
            price: pricePerUnit,
            quantity: quantity
          });
        }
      } catch {}
      
      // Add any additional items from the right section
      cart.forEach(item => {
        finalCart.push({
          name: item.name,
          image: item.image,
          price: item.price,
          quantity: item.quantity
        });
      });

      // Calculate the total that was shown in updateCartDisplay()
      let calculatedTotal = 0;
      try {
        const selectedWithQuantity = JSON.parse(localStorage.getItem('selectedItemWithQuantity') || 'null');
        if (selectedWithQuantity) {
          const previousTotal = selectedWithQuantity.nonCustomizablePrice || 
                               (Number(selectedWithQuantity.totalPrice || selectedWithQuantity.price || 0) * 10);
          calculatedTotal += Number(previousTotal);
        }
      } catch {}
      
      // Add totals from additional cart items
      cart.forEach(item => {
        const subtotal = item.price * item.quantity;
        calculatedTotal += subtotal;
      });
      
      // Clear any previous customization cart to avoid conflicts
      localStorage.removeItem('customizationCart');
      
      localStorage.setItem('nonCustomizableCart', JSON.stringify(finalCart));
      localStorage.setItem('orderTotal', calculatedTotal.toString());
      localStorage.setItem('deliveryInfo', JSON.stringify({ date: deliveryDate, time: deliveryTime, packs }));
      localStorage.setItem('cart', JSON.stringify(finalCart));
      window.location.href = 'cart.html';
    });
  </script>

</body>
</html>
